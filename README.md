
# birthdays_reminder ğŸ‚

> ä¸€ä¸ªå…è´¹çš„æˆå‘˜ç”Ÿæ—¥é‚®ä»¶æé†’å·¥å…·ï¼Œé€‚ç”¨äºè¡Œæ”¿éƒ¨é—¨ã€ç¤¾å›¢å’Œå¥½å‹ç¾¤ä½“ã€‚å®ƒèƒ½å¤Ÿè¯»å–ç”Ÿæ—¥åˆ—è¡¨ï¼ˆæ”¯æŒå…¬å†å’Œå†œå†ï¼‰ï¼Œåœ¨ç”Ÿæ—¥å½“å¤©è‡ªåŠ¨å‘é€é‚®ä»¶æé†’ï¼Œæ–¹ä¾¿æˆ‘ä»¬ä¸ºæˆå‘˜é€ä¸Šç”Ÿæ—¥ç¥ç¦ã€‚ä½œè€…ï¼šINKCOO(ixiaocang/Hitori/å°ä¸œ/ä¿®å…®æ±‚ç´¢/radish)

## ç›®å½• ğŸ“š

- [é¡¹ç›®ç®€ä»‹](#é¡¹ç›®ç®€ä»‹-â„¹ï¸)
- [åŠŸèƒ½ç‰¹ç‚¹](#åŠŸèƒ½ç‰¹ç‚¹-âœ¨)
- [ä½¿ç”¨æ–¹æ³•](#ä½¿ç”¨æ–¹æ³•)
- [è®¸å¯è¯](#è®¸å¯è¯-ğŸ“„)
- [æ›´æ–°æ—¥å¿—](#æ›´æ–°æ—¥å¿—-ğŸ“…)2025.8.4/æœ€æ–°

## é¡¹ç›®ç®€ä»‹ â„¹ï¸

è¿™æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæ—¥æé†’çš„ Python ç¨‹åºï¼Œå®ƒå¯ä»¥é€šè¿‡è¯»å–ç”Ÿæ—¥åˆ—è¡¨ï¼Œåœ¨ç”Ÿæ—¥å½“å¤©è‡ªåŠ¨å‘é€é‚®ä»¶ç»™è‡ªå·±ï¼Œæ–¹ä¾¿æˆ‘ä»¬ç»™æˆå‘˜çš„ç”Ÿæ—¥ç¥ç¦ã€‚æ”¯æŒå…¬å†(é˜³å†)å’Œå†œå†(é˜´å†)ç”Ÿæ—¥æé†’ï¼Œé€‚ç”¨äºä½¿ç”¨ QQ é‚®ç®±å‘é€é‚®ä»¶ã€‚ç”Ÿæ—¥æé†’é‚®ä»¶ä¸ä»…ä¼šå‘é€ç»™è‡ªå·±ï¼Œè¿˜ä¼šå‘é€ä¸€ä»½æé†’é‚®ä»¶ç»™è´Ÿè´£ç®¡ç†å‘˜ã€‚é¡¹ç›®ä¸ºæˆ‘æƒ³è®°å¾—ç»™æ ¡å¿ƒåŠ©ä¼šæˆå‘˜ç”Ÿæ—¥ç¥ç¦åˆè¡·è®¾è®¡ã€‚

ä½œè€… INKCOO (ixiaocang/Hitori/å°ä¸œ/ä¿®å…®æ±‚ç´¢/radish) ç›®å‰æ˜¯ä¸€åæ—¥è¯­ä¸“ä¸šçš„æœ¬ç§‘ç”Ÿï¼Œåœ¨è®¡ç®—æœºé¢†åŸŸè¿˜åœ¨å­¦ä¹ ä¸­ï¼Œè®¡ç®—æœºè¶…çº§èœé¸Ÿä¸€ä¸ªã€‚è¿™ä¸ªç¨‹åºæ˜¯åœ¨ 2024 å¹´ 10 æœˆ 12 æ—¥åˆ©ç”¨ AI è¾…åŠ©åˆ›å»ºçš„ã€‚å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–å»ºè®®ï¼Œè¯·å‘é€é‚®ä»¶è‡³ ixiaocang@foxmail.comï¼Œæ¬¢è¿æå‡ºå®è´µæ„è§ã€‚

## åŠŸèƒ½ç‰¹ç‚¹ âœ¨

- **ç”Ÿæ—¥æé†’**ï¼šæ”¯æŒå…¬å†(é˜³å†)å’Œå†œå†(é˜´å†)ï¼ˆå«é—°æœˆï¼‰ç”Ÿæ—¥æé†’ï¼Œè‡ªåŠ¨åˆ¤æ–­å½“å¤©ç”Ÿæ—¥ã€‚
- **é‚®ä»¶å‘é€**ï¼šåœ¨ç”Ÿæ—¥å½“å¤©è‡ªåŠ¨å‘é€æé†’é‚®ä»¶ç»™è‡ªå·±å’Œç®¡ç†å‘˜ã€‚
- **æ—¥å¿—è®°å½•**ï¼šè®°å½•ç¨‹åºå¯åŠ¨ã€ç»“æŸæ—¶é—´åŠè¿è¡Œæ—¶é•¿ã€‚
- **å¯é…ç½®æ€§**ï¼šé€šè¿‡ç¯å¢ƒå˜é‡é…ç½®é‚®ç®±è´¦å·ã€å¯†ç å’Œç®¡ç†å‘˜é‚®ç®±ï¼Œç¡®ä¿ä¿¡æ¯å®‰å…¨ã€‚

## ä½¿ç”¨æ–¹æ³• ğŸ› ï¸

### [ä¸€ã€GitHubå…è´¹Forkä½¿ç”¨](#1-å…‹éš†åˆ°è‡ªå·±çš„ä»“åº“-ğŸ“¦)
### [äºŒã€æœåŠ¡å™¨éƒ¨ç½²](#61-éƒ¨ç½²åˆ°æœ¬åœ°æœåŠ¡å™¨-ğŸ–¥ï¸)

### ä¸€ã€GitHubå…è´¹Forkä½¿ç”¨
 #1. å…‹éš†åˆ°è‡ªå·±çš„ä»“åº“ ğŸ“¦

åœ¨ GitHub ä¸Šforké¡¹ç›®ï¼Œå®Œæˆåˆå§‹è®¾ç½®ã€‚å¯è®¾ç½®ä¸ºéšç§ä»“åº“ï¼Œé¿å…è¢«äººæŸ¥çœ‹ä½ çš„ç”Ÿæ—¥åˆ—è¡¨ã€‚

### 2. é…ç½®ç”Ÿæ—¥åˆ—è¡¨ ğŸ“

åœ¨é¡¹ç›®æ ¹ç›®å½•çš„ `birthdays.txt` æ–‡ä»¶ä¸­ï¼ŒæŒ‰ç…§å¦‚ä¸‹æ ¼å¼ä¸€è¡Œä¸€ä¸ªæ·»åŠ æˆå‘˜çš„ç”Ÿæ—¥ä¿¡æ¯ï¼š

```txt
å§“å-æœˆ-æ—¥-å…¬å†æˆ–å†œå†ç±»å‹
å¼ ä¸‰-10-12-a
æå››-08-15-b
```

- **a** ä»£è¡¨å…¬å†
- **b** ä»£è¡¨å†œå†

### 3. é…ç½®é‚®ä»¶å®¢æˆ·ç«¯ ğŸ“§

1. ç™»å½•ä½ çš„ QQ é‚®ç®±ã€‚
2. ç‚¹å‡»å³ä¸Šè§’çš„ â€œè®¾ç½®â€ å›¾æ ‡ï¼Œé€‰æ‹© â€œè´¦æˆ·â€ é€‰é¡¹ã€‚
3. æ‰¾åˆ° **SMTP æœåŠ¡** éƒ¨åˆ†ï¼Œç‚¹å‡»å¼€å¯ï¼Œå¹¶ç”Ÿæˆæˆæƒç ã€‚è¿™æ®µæˆæƒç å°†ä½œä¸º **SMTP_PASSWORD** ç”¨äºç¨‹åºä¸­ã€‚

### 4. è®¾ç½® GitHub ä»“åº“ Secrets ğŸ”

1. æ‰“å¼€é¡¹ç›®ä»“åº“çš„ **Settings** é¡µé¢ã€‚
2. è¿›å…¥ **Secrets and variables > Actions** éƒ¨åˆ†ï¼Œç‚¹å‡» **New repository secret**ã€‚
3. æ·»åŠ ä»¥ä¸‹ä¸‰ä¸ª Secretï¼š
   - **SMTP_USER**ï¼šä½ çš„ QQ é‚®ç®±ã€‚
   - **SMTP_PASSWORD**ï¼šç”Ÿæˆçš„æˆæƒç ã€‚
   - **ADMIN_EMAIL**ï¼šç®¡ç†å‘˜é‚®ç®±ï¼ŒæŠ„é€ç”Ÿæ—¥æé†’ç»™ç®¡ç†å‘˜ã€‚

### 5. ä¿®æ”¹ GitHub Actions å·¥ä½œæµè¿è¡Œæ—¶é—´ â±ï¸

é¡¹ç›®é»˜è®¤ä¼šæ¯å¤©åŒ—äº¬æ—¶é—´ä¸Šåˆ 6:05 è¿è¡Œä¸”ä¸å—æ—¶åŒºå½±å“ï¼Œå¦‚éœ€ä¿®æ”¹ï¼Œæ‰“å¼€ `.github/workflows/birthday_reminder.yml` æ–‡ä»¶ï¼Œè°ƒæ•´ `cron` é…ç½®å³å¯ï¼š

```yaml
- cron: '15 22 * * *'  # åŒ—äº¬æ—¶é—´æ—©ä¸Š6ç‚¹15ï¼ˆ22+8ä¸ºæ¬¡æ—¥å…­ç‚¹ï¼‰
- cron: '0 22 * * *'   # åŒ—äº¬æ—¶é—´æ—©ä¸Š6ç‚¹
```
### åˆ°æ­¤ä½ çš„é¡¹ç›®å°±å·®ä¸å¤šé…ç½®å¥½äº†ï¼Œæœ€åéœ€è¦åœ¨ä»“åº“Action çš„Birthday Reminderå·¥ä½œæµä¸­å¯ç”¨å·¥ä½œæµï¼Œæ‰‹åŠ¨è¿è¡Œæµ‹è¯•ä¸€ä¸‹ï¼Œä¹‹åä¾¿å¯è‡ªåŠ¨è¿è¡Œ

### 5.1 å·¥ä½œæµä¿æ´»ï¼šé¿å…60å¤©ä»“åº“æ— æäº¤å¯¼è‡´å·¥ä½œæµç¦ç”¨ ğŸ’ª
é…ç½®æ–‡ä»¶`birthdays_reminder\.github\workflows\keep_active.yml`

1. åœ¨ä»“åº“ `Settings > Actions > General` é¡µé¢
2. æ‰¾åˆ° "Workflow permissions" éƒ¨åˆ†
3. å‹¾é€‰ "Read and write permissions"
4. ç‚¹å‡» Save æŒ‰é’®
5. æ¥ç€å¯ç”¨å·¥ä½œæµ
6. æäº¤æ–‡ä»¶åï¼Œè½¬åˆ°ä»“åº“çš„ "Actions" æ ‡ç­¾é¡µ
7. æ‰¾åˆ° "Keep Repository Active" å·¥ä½œæµ
8. ç‚¹å‡» "Enable workflow"

---
***

### 6.1 éƒ¨ç½²åˆ°æœ¬åœ°æœåŠ¡å™¨ ğŸ–¥ï¸

å¦‚éœ€éƒ¨ç½²åˆ°æœ¬åœ°æœåŠ¡å™¨ï¼Œåªéœ€å¤åˆ¶ä»¥ä¸‹ Python ä»£ç å¹¶ä¿å­˜ä¸º `birthdays_reminder.py`ï¼Œå¹¶å®‰è£…ä¾èµ–ã€‚

```python
import smtplib
from email.mime.text import MIMEText
from datetime import datetime
import lunardate
import pytz
from dotenv import load_dotenv
import os

load_dotenv('email.env')

def read_birthdays(filename):
    birthdays = []
    with open(filename, 'r') as file:
        for line in file:
            parts = line.strip().split('-')
            if len(parts) == 4:
                name, month, day, calendar_type = parts
                birthdays.append((name, f"{month}/{day}", calendar_type))
            else:
                print(f"è·³è¿‡æ ¼å¼ä¸æ­£ç¡®çš„è¡Œ: {line.strip()}")
    return birthdays

def get_lunar_date_in_beijing():
    tz = pytz.timezone('Asia/Shanghai')
    now = datetime.now(tz)
    lunar_date = lunardate.LunarDate.fromSolarDate(now.year, now.month, now.day)
    return lunar_date

def is_birthday_today(date, calendar_type):
    tz = pytz.timezone('Asia/Shanghai')
    today = datetime.now(tz)

    if calendar_type == 'a':
        month, day = map(int, date.split('/'))
        return today.month == month and today.day == day
    elif calendar_type == 'b':
        lunar_today = get_lunar_date_in_beijing()
        month, day = map(int, date.split('/'))
        return lunar_today.month == month and lunar_today.day == day
    return False

def send_email(subject, body, to_email):
    smtp_server = "smtp.qq.com"
    smtp_port = 465
    smtp_user = os.getenv('SMTP_USER')
    smtp_password = os.getenv('SMTP_PASSWORD')

    msg = MIMEText(body)
    msg['Subject'] = subject
    msg['From'] = smtp_user
    msg['To'] = to_email

    with smtplib.SMTP_SSL(smtp_server, smtp_port) as server:
        server.login(smtp_user, smtp_password)
        server.sendmail(smtp_user, [to_email], msg.as_string())

def main():
    print("è¯»å–ç”Ÿæ—¥åˆ—è¡¨...")
    birthdays = read_birthdays('birthdays.txt')
    print("æ£€æŸ¥ç”Ÿæ—¥æ˜¯å¦æ˜¯ä»Šå¤©...")

    admin_email = os.getenv('ADMIN_EMAIL')

    today_birthdays = []

    for name, date, calendar_type in birthdays:
        if is_birthday_today(date, calendar_type):
            birthday_type = "(å…¬å†)" if calendar_type == 'a' else "(å†œå†)"
            today_birthdays.append((name, birthday_type))
            print(f"ä»Šå¤©æ˜¯ {name} çš„ç”Ÿæ—¥ {birthday_type}!")
        else:
            print(f"{name} ä»Šå¤©ä¸æ˜¯ç”Ÿæ—¥ã€‚")

    tz = pytz.timezone('Asia/Shanghai')
    now = datetime.now(tz)
    formatted_time = now.strftime("%Y-%m-%d %H:%M:%S %Z")

    if today_birthdays:
        if len(today_birthdays) == 1:
            name_with_type = f"{today_birthdays[0][0]} {today_birthdays[0][1]}"
            subject = f"ç”Ÿæ—¥æé†’: ä»Šå¤©æ˜¯ {name_with_type} çš„ç”Ÿæ—¥"
            body = f"ä»Šå¤©æ˜¯ {name_with_type} çš„ç”Ÿæ—¥ï¼Œè¯·è®°å¾—ç¥ç¦ TAï¼\n\né‚®ä»¶å‘é€æ—¶é—´: {formatted_time}"
        else:
            names_with_types = "ã€".join([f"{name} {birthday_type}" for name, birthday_type in today_birthdays])
            subject = "ç”Ÿæ—¥æé†’: ä»Šå¤©æœ‰å¤šä½æˆå‘˜çš„ç”Ÿæ—¥"
            body = f"ä»Šå¤©æ˜¯ {names_with_types} çš„ç”Ÿæ—¥ï¼Œè¯·è®°å¾—ç¥ç¦ä»–ä»¬ï¼\n\né‚®ä»¶å‘é€æ—¶é—´: {formatted_time}"

        send_email(subject, body, os.getenv('SMTP_USER'))
        print(f"ç”Ÿæ—¥æé†’é‚®ä»¶å·²å‘é€ç»™æˆå‘˜ï¼Œå‘é€æ—¶é—´: {formatted_time}")

        if admin_email:
            send_email(subject, body, admin_email)
            print(f"ç”Ÿæ—¥æé†’é‚®ä»¶å·²å‘é€ç»™ç®¡ç†å‘˜ {admin_email}ï¼Œå‘é€æ—¶é—´: {formatted_time}")

if __name__ == "__main__":
    main()
```

### 6.2 é…ç½®ç¯å¢ƒå˜é‡ âš™ï¸

åœ¨åŒç›®å½•åˆ›å»º `email.env` æ–‡ä»¶ï¼Œå­˜å‚¨é‚®ç®±ä¿¡æ¯ï¼š

```txt
SMTP_USER=your_smtp_user@example.com
SMTP_PASSWORD=your_smtp_password
ADMIN_EMAIL=your_admin_email@example.com
```
ä»¥åŠåˆ›å»º`birthdays.txt`ç”Ÿæ—¥åˆ—è¡¨æ–‡ä»¶
### 6.3 å®‰è£…ä¾èµ–ï¼ˆpython3ï¼‰ğŸ“¦

```bash
pip3 install python-dotenv smtplib pytz lunardate
```
### 6.4 è‡ªåŠ¨è¿è¡Œ â°
é…ç½®å¥½åé€šè¿‡è®¡åˆ’ä»»åŠ¡`python3 birthdays_reminder.py`è¿è¡Œå°±å¥½äº†

## è®¸å¯è¯ ğŸ“„

æœ¬é¡¹ç›®é‡‡ç”¨ **[GPL3.0](https://www.gnu.org/licenses/gpl-3.0.en.html#license-text)** è¿›è¡Œè®¸å¯ã€‚ä½ å¯ä»¥å…è´¹ä½¿ç”¨ã€ä¿®æ”¹å’Œåˆ†å‘æœ¬é¡¹ç›®çš„ä»£ç ï¼Œä½†å¿…é¡»éµå®ˆGPL3.0çš„è®¸å¯è¯æ¡æ¬¾ã€‚å¦‚éœ€å•†ä¸šè®¸å¯ï¼Œè¯·è”ç³»ä½œè€…ixiaocang@fomail.comã€‚


## æ›´æ–°æ—¥å¿— ğŸ“…

**2025.8.4æ›´æ–°ï¼Œæ–°å¢äº†å·¥ä½œæµä¿æ´»çš„é…ç½®æ–‡ä»¶ï¼Œé¿å…60å¤©ä»“åº“æ— æäº¤å¯¼è‡´å·¥ä½œæµç¦ç”¨ï¼Œä¿®å¤äº†github actions æ§åˆ¶å°è¿”å›æŠ¥é”™é—®é¢˜
,ä¿®æ”¹ä»‹ç»æ–‡æ¡£ï¼Œä¿®æ”¹è®¸å¯è¯ä¸ºGPL3.0**

**2024.10.15æ™šæ›´æ–°ï¼Œåœ¨é‚®ä»¶å’Œåå°çª—å£æ—¥å¿—ä¸­æ·»åŠ æˆå‘˜ç”Ÿæ—¥æ˜¯å±äºå†œå†è¿˜æ˜¯å…¬å†**

**2024.10.16æ—©æ›´æ–°ï¼Œä¿®æ”¹çš„ç”Ÿæ—¥åˆ¤æ–­æ”¹ä¸ºç”¨åŒ—äº¬æ—¶é—´åˆ¤æ–­ï¼Œé¿å…githubè¿è¡Œçš„æ—¶åŒºå½±å“**

**2024.10.17æ—©æ›´æ–°ï¼Œä¿®æ”¹çš„å†œå†æ—¶é—´åŠç”Ÿæ—¥åˆ¤æ–­æ”¹ä¸ºç”¨åŒ—äº¬æ—¶é—´åˆ¤æ–­ï¼Œé¿å…githubè¿è¡Œçš„æ—¶åŒºå½±å“**
