name: Keep Repository Active
# å·¥ä½œæµæè¿°ï¼šå®šæœŸåˆ›å»ºç©ºæäº¤ä¿æŒä»“åº“æ´»è·ƒï¼Œé¿å…é•¿æ—¶é—´ä¸æ´»è·ƒå¯¼è‡´è®¡åˆ’å·¥ä½œæµè¢«ç¦ç”¨

on:
  schedule:
    # æ¯30å¤©åœ¨UTCæ—¶é—´00:00è¿è¡Œï¼ˆæ¯æœˆ1å·ï¼‰
    # */2 è¡¨ç¤ºæ¯2ä¸ªæœˆï¼Œå³60å¤©è¿è¡Œ1æ¬¡
    # è°ƒæ•´ä¸ºï¼šä½¿ç”¨ '0 0 1 * *' è¡¨ç¤ºæ¯æœˆ1å·è¿è¡Œï¼Œæ›´ç¬¦åˆéœ€æ±‚
    - cron: '0 0 1 * *'
  
  # å…è®¸æ‰‹åŠ¨è§¦å‘ï¼ˆè°ƒè¯•ç”¨ï¼‰
  workflow_dispatch:

permissions:
  contents: write  # å¿…é¡»çš„å†™å…¥æƒé™

jobs:
  commit-empty:
    runs-on: ubuntu-latest
    # è®¾ç½®è¶…æ—¶å‡å°‘èµ„æºå ç”¨
    timeout-minutes: 3
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          # ä½¿ç”¨ GitHub è‡ªåŠ¨ç”Ÿæˆ token è·å–ä»“åº“æƒé™
          token: ${{ secrets.GITHUB_TOKEN }}
          
          # ä»…è·å–æœ€æ–°æäº¤å†å²ï¼ˆé™ä½èµ„æºæ¶ˆè€—ï¼‰
          fetch-depth: 1
          
          # ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„ ref
          ref: ${{ github.head_ref || github.ref }}

      - name: Configure Git
        run: |
          # é…ç½® Git èº«ä»½ä¿¡æ¯ï¼ˆä½¿ç”¨ GitHub Actions é»˜è®¤èº«ä»½ï¼‰
          git config user.name "GitHub Actions Bot"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # è®¾ç½®æ¨é€ç­–ç•¥ï¼ˆé¿å…å› å†å²å·®å¼‚å¯¼è‡´é—®é¢˜ï¼‰
          git config --local push.default current

      - name: Verify previous commit
        id: verify_commit
        run: |
          # æ£€æŸ¥æœ€æ–°æäº¤æ˜¯å¦å·²ç»æ˜¯ç©ºæäº¤
          if git log -1 --pretty=%B | grep -q "ğŸ¤– ä¿æŒä»“åº“å·¥ä½œæµè¿è¡Œ"; then
            echo "SKIP_COMMIT=true" >> $GITHUB_OUTPUT
          else
            echo "SKIP_COMMIT=false" >> $GITHUB_OUTPUT
          fi
        shell: bash

      - name: Create empty commit
        # ä»…åœ¨æ²¡æœ‰ç©ºæäº¤æ—¶æ‰§è¡Œ
        if: ${{ steps.verify_commit.outputs.SKIP_COMMIT == 'false' }}
        run: |
          # åˆ›å»ºç©ºæäº¤å¹¶æ¨é€åˆ°å½“å‰åˆ†æ”¯
          git commit --allow-empty -m "ğŸ¤– ä¿æŒä»“åº“å·¥ä½œæµè¿è¡Œ(ç©ºç™½æäº¤)"
          git push
